<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AI Dodge Game</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
        font-family: 'Arial', sans-serif;
        color: white;
        width: 100vw; height: 100vh;
    }
    #gameContainer {
        position: relative;
        width: 100vw;
        height: 100vh;
        max-width: 500px;
        max-height: 90vh;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: none;
        z-index: 1;
    }
    #gameCanvas {
        width: 100%;
        height: 100%;
        max-width: 500px;
        max-height: 90vh;
    }
    #score {
        position: absolute;
        top: 24px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2.2rem;
        color: #ff6ec7;
        font-weight: bold;
        text-shadow: 0 2px 8px #000a;
        z-index: 10;
    }
    #gameOver {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        font-size: 2.2rem;
        color: #fff;
        background: rgba(32,32,64,0.95);
        border-radius: 18px;
        padding: 32px 24px 24px 24px;
        box-shadow: 0 0 24px #ff6ec7;
        z-index: 20;
    }
    #restartBtn {
        margin-top: 20px;
        padding: 12px 32px;
        font-size: 1.2rem;
        background: #ff6ec7;
        border: none;
        border-radius: 10px;
        color: white;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 2px 8px #000a;
        transition: background 0.2s;
    }
    #restartBtn:hover {
        background: #ff2e63;
    }
    #joystick {
        position: fixed;
        left: 50%;
        bottom: 3vh;
        width: 140px;
        height: 140px;
        background: rgba(255,255,255,0.08);
        border: 2.5px solid #ff6ec7;
        border-radius: 50%;
        z-index: 100;
        touch-action: none;
        user-select: none;
        transform: translateX(-50%);
        box-shadow: 0 2px 16px #ff6ec7;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #stick {
        width: 70px;
        height: 70px;
        background: #ff6ec7;
        border-radius: 50%;
        box-shadow: 0 2px 12px #ff6ec7;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
    }
</style>
</head>
<body>
<div id="gameContainer">
  <div id="score">Score: 0</div>
  <div id="gameOver">
      You Lost!<br>
      <button id="restartBtn">Restart</button>
  </div>
  <canvas id="gameCanvas"></canvas>
</div>
<div id="joystick">
  <div id="stick"></div>
</div>
<script>
const gameContainer = document.getElementById('gameContainer');
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Player
const player = {x: canvas.width/2, y: canvas.height*0.8, r: Math.max(canvas.width, canvas.height)*0.04, speed: Math.max(canvas.width, canvas.height)*0.012};
let balls = [];
let score = 0;
let frame = 0;
let gameOver = false;

// Joystick state
let joystick = {
  active: false,
  dx: 0,
  dy: 0,
  radius: 70,
  stickRadius: 35
};
const joy = document.getElementById('joystick');
const stick = document.getElementById('stick');

function resizeAll() {
  // Responsive container and canvas
  let w = Math.min(window.innerWidth, 500);
  let h = Math.min(window.innerHeight * 0.9, 900);
  gameContainer.style.width = w + 'px';
  gameContainer.style.height = h + 'px';
  canvas.width = w;
  canvas.height = h;
  player.x = canvas.width/2;
  player.y = canvas.height-80;
  player.r = Math.max(canvas.width, canvas.height)*0.04;
  joy.style.width = joy.style.height = (player.r*4.4) + 'px';
  stick.style.width = stick.style.height = (player.r*2.2) + 'px';
}
window.addEventListener('resize', resizeAll);
resizeAll();

// Joystick events
joy.addEventListener('touchstart', function(e) {
  joystick.active = true;
  joystick.dx = 0;
  joystick.dy = 0;
  e.preventDefault();
});
joy.addEventListener('touchmove', function(e) {
  if (!joystick.active) return;
  const t = e.touches[0];
  const rect = joy.getBoundingClientRect();
  let dx = t.clientX - rect.left - rect.width/2;
  let dy = t.clientY - rect.top - rect.height/2;
  const dist = Math.sqrt(dx*dx + dy*dy);
  if (dist > player.r*2.2) {
    dx = dx * player.r*2.2 / dist;
    dy = dy * player.r*2.2 / dist;
  }
  joystick.dx = dx;
  joystick.dy = dy;
  stick.style.left = (50 + dx/(player.r*2.2)*50) + '%';
  stick.style.top = (50 + dy/(player.r*2.2)*50) + '%';
  e.preventDefault();
});
joy.addEventListener('touchend', function(e) {
  joystick.active = false;
  joystick.dx = 0;
  joystick.dy = 0;
  stick.style.left = '50%';
  stick.style.top = '50%';
  e.preventDefault();
});

let level = 0;
const levels = [
  { name: 'Slow', score: 0, speed: [3, 5] },
  { name: 'Medium', score: 200, speed: [4, 6] },
  { name: 'Fast', score: 400, speed: [5, 7] },
  { name: 'Super Fast', score: 800, speed: [6, 8] },
  { name: 'Flash', score: 1600, speed: [7, 10] },
  { name: 'Sharinggan', score: 3200, speed: [8, 12] }
];

function getCurrentLevel() {
  for (let i = levels.length - 1; i >= 0; i--) {
    if (score >= levels[i].score) return i;
  }
  return 0;
}

function spawnBall() {
  const r = Math.max(canvas.width, canvas.height)*0.035;
  const x = Math.random() * (canvas.width - r*2) + r;
  const y = -r;
  level = getCurrentLevel();
  const minSpeed = levels[level].speed[0];
  const maxSpeed = levels[level].speed[1];
  const angle = Math.PI/2 + (Math.random()-0.5)*0.7;
  const speed = minSpeed + Math.random()*(maxSpeed-minSpeed);
  balls.push({x, y, r, dx: speed*Math.cos(angle), dy: speed*Math.sin(angle), color: '#ff2e63'});
}

function updateBalls() {
  for (let i = balls.length - 1; i >= 0; i--) {
    const b = balls[i];
    b.x += b.dx;
    b.y += b.dy;
    // Bounce off walls
    if (b.x - b.r < 0) { b.x = b.r; b.dx *= -1; }
    if (b.x + b.r > canvas.width) { b.x = canvas.width - b.r; b.dx *= -1; }
    if (b.y - b.r < 0) { b.y = b.r; b.dy *= -1; }
    if (b.y + b.r > canvas.height) { b.y = canvas.height - b.r; b.dy *= -1; }
  }
}

function checkCollision(a, b) {
  const dx = (a.x + a.r) - (b.x);
  const dy = (a.y + a.r) - (b.y);
  const dist = Math.sqrt(dx*dx + dy*dy);
  return dist < a.r + b.r;
}

function drawCircle(obj, color, shadow) {
  ctx.save();
  ctx.beginPath();
  ctx.arc(obj.x, obj.y, obj.r, 0, Math.PI*2);
  ctx.shadowColor = shadow;
  ctx.shadowBlur = 18;
  ctx.fillStyle = color;
  ctx.fill();
  ctx.restore();
}

function update() {
  if(gameOver) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // Draw level
  ctx.font = 'bold 1.2rem Arial';
  ctx.fillStyle = '#ff6ec7';
  ctx.textAlign = 'center';
  ctx.fillText('Level: ' + levels[level].name, canvas.width/2, 40);
  // Draw player
  drawCircle(player, '#4CAF50', '#00ffcc');
  // Draw balls
  balls.forEach(b => drawCircle(b, b.color, '#ff6ec7'));
  // Move balls
  updateBalls();
  // Check collision
  for (let b of balls) {
    if (checkCollision(player, b)) {
      gameOver = true;
      document.getElementById('gameOver').style.display = 'block';
      return;
    }
  }
  // Player movement with joystick
  if (joystick.active && (joystick.dx !== 0 || joystick.dy !== 0)) {
    const mag = Math.sqrt(joystick.dx*joystick.dx + joystick.dy*joystick.dy);
    if (mag > 5) {
      const nx = joystick.dx / (player.r*2.2);
      const ny = joystick.dy / (player.r*2.2);
      let px = player.x + nx * player.speed;
      let py = player.y + ny * player.speed;
      if (px < 0) px = 0;
      if (px + player.r*2 > canvas.width) px = canvas.width - player.r*2;
      if (py < 0) py = 0;
      if (py + player.r*2 > canvas.height) py = canvas.height - player.r*2;
      player.x = px;
      player.y = py;
    }
  }
  // Spawn balls every 90 frames
  frame++;
  if (frame % 90 === 0) spawnBall();
  // Score
  score++;
  document.getElementById('score').innerText = "Score: " + score;
  requestAnimationFrame(update);
}

// Restart button
document.getElementById('restartBtn').addEventListener('click', () => {
    balls = [];
    player.x = canvas.width/2;
    player.y = canvas.height-80;
    score = 0;
    gameOver = false;
    document.getElementById('score').innerText = "Score: 0";
    document.getElementById('gameOver').style.display = 'none';
    update();
});

// Start game
update();
</script>
</body>
</html>
