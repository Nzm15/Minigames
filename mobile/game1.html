<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AI Dodgeball Arena - Mobile</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    height: 100vh;
  }
  canvas {
    background: #111;
    border: 3px solid #ff6ec7;
    border-radius: 15px;
    box-shadow: 0 0 20px #ff6ec7;
    margin-top: 10px;
    display: block;
  }
  h1 {
    margin: 10px;
    color: #ff6ec7;
  }
  #gameOver {
    display: none;
    text-align: center;
  }
  #restartBtn {
    padding: 10px 20px;
    font-size: 18px;
    margin-top: 10px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background: #ff6ec7;
    color: #fff;
    transition: 0.3s;
  }
  #restartBtn:hover {
    background: #ff2e63;
  }
  /* Joystick styles */
  #joystick {
    position: fixed;
    left: 50%;
    bottom: 40px;
    width: 140px;
    height: 140px;
    background: rgba(255,255,255,0.08);
    border: 2px solid #ff6ec7;
    border-radius: 50%;
    z-index: 1000;
    touch-action: none;
    user-select: none;
    transform: translateX(-50%);
  }
  #stick {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 70px;
    height: 70px;
    background: #ff6ec7;
    border-radius: 50%;
    transform: translate(-50%,-50%);
  }
</style>
</head>
<body>
<h1 id="score">Score: 0</h1>
<canvas id="gameCanvas"></canvas>
<div id="gameOver">
  <h1 id="finalScore"></h1>
  <button id="restartBtn">Restart</button>
</div>
<div id="joystick">
  <div id="stick"></div>
</div>
<script>
const BASE_WIDTH = 400;
const BASE_HEIGHT = 700;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  // Get window size and fit to aspect ratio
  let w = window.innerWidth;
  let h = window.innerHeight;
  let scale = Math.min(w / BASE_WIDTH, h / BASE_HEIGHT);
  canvas.width = BASE_WIDTH;
  canvas.height = BASE_HEIGHT;
  canvas.style.width = (BASE_WIDTH * scale) + 'px';
  canvas.style.height = (BASE_HEIGHT * scale) + 'px';
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const player = { x: 200, y: 600, radius: 22, speed: 7, color: '#00ffcc' };
let balls = [];
let score = 0;
let frame = 0;
let gameRunning = true;
let level = 0;
const levels = [
  { name: 'Slow', score: 0, speed: [2, 4] },
  { name: 'Medium', score: 200, speed: [3, 5] },
  { name: 'Fast', score: 400, speed: [4, 6] },
  { name: 'Super Fast', score: 800, speed: [5, 7] },
  { name: 'Flash', score: 1600, speed: [6, 8] },
  { name: 'Sharinggan', score: 3200, speed: [7, 10] }
];

// Joystick state
let joystick = {
  active: false,
  dx: 0,
  dy: 0,
  radius: 70,
  stickRadius: 35
};

const joy = document.getElementById('joystick');
const stick = document.getElementById('stick');

function updateJoystickPosition() {
  // Place joystick at bottom center, scaled
  let w = window.innerWidth;
  let h = window.innerHeight;
  let scale = Math.min(w / BASE_WIDTH, h / BASE_HEIGHT);
  joy.style.width = (joystick.radius * 2 * scale) + 'px';
  joy.style.height = (joystick.radius * 2 * scale) + 'px';
  joy.style.left = '50%';
  joy.style.bottom = (40 * scale) + 'px';
  joy.style.transform = 'translateX(-50%)';
  stick.style.width = (joystick.stickRadius * 2 * scale) + 'px';
  stick.style.height = (joystick.stickRadius * 2 * scale) + 'px';
  stick.style.left = '50%';
  stick.style.top = '50%';
}
window.addEventListener('resize', updateJoystickPosition);
updateJoystickPosition();

joy.addEventListener('touchstart', function(e) {
  joystick.active = true;
  joystick.dx = 0;
  joystick.dy = 0;
  e.preventDefault();
});
joy.addEventListener('touchmove', function(e) {
  if (!joystick.active) return;
  const t = e.touches[0];
  const rect = joy.getBoundingClientRect();
  let scale = joy.offsetWidth / (joystick.radius * 2);
  let dx = (t.clientX - rect.left - joy.offsetWidth/2) / scale;
  let dy = (t.clientY - rect.top - joy.offsetHeight/2) / scale;
  const dist = Math.sqrt(dx*dx + dy*dy);
  if (dist > joystick.radius) {
    dx = dx * joystick.radius / dist;
    dy = dy * joystick.radius / dist;
  }
  joystick.dx = dx;
  joystick.dy = dy;
  stick.style.left = (50 + dx/joystick.radius*50) + '%';
  stick.style.top = (50 + dy/joystick.radius*50) + '%';
  e.preventDefault();
});
joy.addEventListener('touchend', function(e) {
  joystick.active = false;
  joystick.dx = 0;
  joystick.dy = 0;
  stick.style.left = '50%';
  stick.style.top = '50%';
  e.preventDefault();
});

function getCurrentLevel() {
  for (let i = levels.length - 1; i >= 0; i--) {
    if (score >= levels[i].score) return i;
  }
  return 0;
}

function spawnBall() {
  // AI ball aims at player from its spawn point with some randomness
  const radius = 15;
  const x = Math.random() * (canvas.width - radius * 2) + radius;
  const y = -radius;
  const angleToPlayer = Math.atan2(player.y - y, player.x - x);
  const angle = angleToPlayer + (Math.random() - 0.5) * 0.6;
  level = getCurrentLevel();
  const minSpeed = levels[level].speed[0];
  const maxSpeed = levels[level].speed[1];
  const speed = minSpeed + Math.random() * (maxSpeed - minSpeed);
  const ball = {
    x,
    y,
    radius,
    color: '#ff2e63',
    dx: speed * Math.cos(angle),
    dy: speed * Math.sin(angle)
  };
  if (balls.length < 40) balls.push(ball);
}

function updatePlayer() {
  if (joystick.active && (joystick.dx !== 0 || joystick.dy !== 0)) {
    const mag = Math.sqrt(joystick.dx*joystick.dx + joystick.dy*joystick.dy);
    if (mag > 5) {
      const nx = joystick.dx / joystick.radius;
      const ny = joystick.dy / joystick.radius;
      let px = player.x + nx * player.speed;
      let py = player.y + ny * player.speed;
      if (px - player.radius < 0) px = player.radius;
      if (px + player.radius > canvas.width) px = canvas.width - player.radius;
      if (py - player.radius < 0) py = player.radius;
      if (py + player.radius > canvas.height) py = canvas.height - player.radius;
      player.x = px;
      player.y = py;
    }
  }
}

function updateBalls() {
  for (let i = balls.length - 1; i >= 0; i--) {
    const b = balls[i];
    b.x += b.dx;
    b.y += b.dy;
    if (b.x - b.radius < 0) {
      b.x = b.radius;
      b.dx *= -1;
    } else if (b.x + b.radius > canvas.width) {
      b.x = canvas.width - b.radius;
      b.dx *= -1;
    }
    if (b.y + b.radius > canvas.height) {
      b.y = canvas.height - b.radius;
      b.dy *= -1;
    }
    if (b.y < -200 || b.y > canvas.height + 200) {
      balls.splice(i, 1);
    }
  }
}

function checkCollision(a, b) {
  const dx = a.x - b.x;
  const dy = a.y - b.y;
  const distance = Math.sqrt(dx*dx + dy*dy);
  return distance < a.radius + b.radius;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.font = 'bold 24px Arial';
  ctx.fillStyle = '#ff6ec7';
  ctx.textAlign = 'center';
  ctx.fillText('Level: ' + levels[level].name, canvas.width/2, 40);
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
  ctx.fill();
  balls.forEach(b => {
    ctx.fillStyle = b.color;
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2);
    ctx.fill();
  });
}

function endGame() {
  gameRunning = false;
  document.getElementById('gameCanvas').style.display = 'none';
  document.getElementById('gameOver').style.display = 'block';
  document.getElementById('finalScore').textContent = `You Lose! Final Score: ${score}`;
}

document.getElementById('restartBtn').addEventListener('click', () => location.reload());

function gameLoop() {
  if(!gameRunning) return;

  frame++;
  updatePlayer();
  updateBalls();

  // Check collision with balls
  for(let b of balls) {
    if(checkCollision(player,b)) {
      endGame();
      return;
    }
  }

  // Spawn balls periodically
  if(frame % 120 === 0) spawnBall();

  draw();
  score++;
  document.getElementById('score').textContent = `Score: ${score}`;

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
